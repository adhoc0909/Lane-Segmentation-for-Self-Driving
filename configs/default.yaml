project:
  name: sdlane-baseline
  seed: 42

paths:
  sdlane_root: null
  out_dir: outputs
  run_name: exp001

data:
  splits:
      train:
        dir: "train"
        list: "train_list.txt"
      test:
        dir: "test"
        list: "test_list.txt"
  image_size: [640, 400]   # W,H
  #image_size: [1024, 1024]
  lane_thickness: 6
  val_ratio: 0.2
  num_workers: 32
  pin_memory: true
  persistent_workers: true
  use_precomputed_masks: true
  mask_subdir: "masks"      # precompute 스크립트가 저장한 폴더명
  mask_ext: "png"
  fallback_to_json: false    # 마스크 없으면 JSON로 생성해서 진행(디버깅 끝나면 false 추천)
  lane_thickness: 6

augment:
  enabled: true
  # --- geometric ---
  hflip_p: 0.0
  shift_scale_rotate_p: 0.0
  shift_limit: 0.02
  scale_limit: 0.05
  rotate_limit: 3.0

  # --- photometric ---
  clahe_p: 0.0
  clahe_clip_limit: 2.0
  clahe_tile_grid_size: [8, 8]
  brightness_contrast_p: 0.2
  brightness_limit: 0.2
  contrast_limit: 0.2
  gamma_p: 0.1
  gamma_limit: [80, 120]
  hsv_p: 0.0
  hue_shift_limit: 10
  sat_shift_limit: 15
  val_shift_limit: 10
  rgb_shift_p: 0.0
  r_shift_limit: 10
  g_shift_limit: 10
  b_shift_limit: 10

  # --- blur/noise/compression ---
  blur_p: 0.05  # backward compatible alias
  gaussian_blur_p: 0.0
  gaussian_blur_limit: [3, 5]
  motion_blur_p: 0.0
  motion_blur_limit: 5
  gauss_noise_p: 0.0
  gauss_noise_var_limit: [10.0, 50.0]
  gauss_noise_mean: 0.0
  jpeg_p: 0.0
  jpeg_quality_lower: 70
  jpeg_quality_upper: 100

  # --- weather ---
  rain_p: 0.0
  rain_drop_length: 20
  rain_drop_width: 1
  rain_blur_value: 3
  rain_brightness_coeff: 0.9
  fog_p: 0.0
  fog_coef_lower: 0.1
  fog_coef_upper: 0.3
  fog_alpha_coef: 0.08

model:
  arch: unet
  encoder: resnet34
  pretrained: true
  in_channels: 3
  num_classes: 1

train:
  early_stop:
    enabled: true
    patience: 15        # 개선 없으면 몇 epoch 기다릴지
    min_delta: 0.0      # 개선으로 인정할 최소 변화량
    warmup_epochs: 0    # 0이면 바로 적용, 예: 5로 두면 5epoch 이후부터 early stop
  device: cuda
  batch_size: 8
  epochs: 20
  lr: 0.0003
  weight_decay: 0.00001
  amp: true
  grad_clip_norm: 0.0
  scheduler:
    name: cosine
    t_max: 20
    step_size: 10
    gamma: 0.1
  checkpoint:
    save_every: 10
    metric: dice
    mode: max
  resume: null   # 이어학습 안 하면 null, 하면 모델 경로


loss:
  name: bce_dice
  bce_weight: 0.5
  dice_weight: 0.5
  smooth: 1.0

eval:
  threshold: 0.5

infer:
  weights: null
  input: null
  output: outputs/infer

wandb:
  enabled: true          # false면 wandb 완전 비활성
  project: "lane-segmentation"
  entity: null           # 개인 계정이면 null
  watch: false           # true면 gradient/parameter 추적 (무거움)

# -------------------------------------------------
# YOLOv11-seg backend (instance segmentation)
# - We train on dataset converted from SDLane binary lane masks.
# - We treat lane as a single class (0) and union instance masks at inference.
# -------------------------------------------------
yolo:
  weights: yolo11n-seg.pt
  imgsz: [640, 400]
  epochs: 50
  batch: 8
  device: 0
  conf: 0.25
  iou: 0.7
  classes: null
  link_files: true           # symlink images to save disk (falls back to copy if not supported)
  poly_simplify_eps: 1.5     # contour simplification (% of perimeter)
  poly_min_area: 16.0
  hyp: {}                    # extra ultralytics train kwargs (e.g., lr0, mosaic, hsv, etc.)
